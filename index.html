<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Novel-Apps</title>

  <!-- PWA Manifest & Theme Color -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">

  <!-- iOS specific meta tags for a more app-like feel when added to homescreen -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Tailwind CSS CDN - Mobile First -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      important: true,
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0fdfa',
              100: '#ccfbf1',
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a',
              950: '#042f2e',
            },
            dark: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
              950: '#020617',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.3s ease-out',
            'bounce-in': 'bounceIn 0.3s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            bounceIn: {
              '0%': { transform: 'scale(0.3)', opacity: '0' },
              '50%': { transform: 'scale(1.05)', opacity: '0.8' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
          }
        }
      }
    }
  </script>


<script type="importmap">
{
  "imports": {
    "jszip": "https://esm.sh/jszip@3.10.1?bundle",
    "url": "https://aistudiocdn.com/url@^0.11.4",
    "path": "https://aistudiocdn.com/path@^0.12.7",
    "fs": "https://aistudiocdn.com/fs@^0.0.1-security"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-gradient-to-br dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 dark:text-slate-100 min-h-screen font-sans antialiased text-base leading-relaxed transition-colors duration-300">
  <!-- Mobile-first header -->
  <header class="flex items-center justify-between p-4 bg-white/80 dark:bg-slate-800/50 backdrop-blur-sm border-b border-gray-200 dark:border-slate-700 md:hidden sticky top-0 z-50" style="padding-top: calc(1rem + env(safe-area-inset-top));">
    <h1 class="text-xl font-bold text-gray-900 dark:text-white" id="appTitle">Novel-Apps</h1>
    <div class="flex items-center gap-2">
      <button class="theme-toggle-btn text-2xl text-slate-500 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700" aria-label="Toggle theme">
        <svg class="sun-icon h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-15.66l-.7.7m-12.28 12.28l-.7.7M21 12h-1M4 12H3m15.66 8.66l-.7-.7m-12.28-12.28l-.7-.7"></path></svg>
        <svg class="moon-icon h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
      </button>
      <button onclick="toggleMenu()" class="text-2xl text-slate-500 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700">
        ☰
      </button>
    </div>
  </header>
  
  <!-- Desktop header -->
  <header class="hidden md:flex items-center justify-between p-6 bg-white/80 dark:bg-slate-800/50 backdrop-blur-sm border-b border-gray-200 dark:border-slate-700 sticky top-0 z-50" style="padding-top: calc(1.5rem + env(safe-area-inset-top));">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white" id="appTitle">Novel-Apps</h1>
    <div class="absolute top-1/2 right-72 transform -translate-y-1/2">
      <button class="theme-toggle-btn text-2xl text-slate-500 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white transition-colors p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700" aria-label="Toggle theme">
        <svg class="sun-icon h-6 w-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-15.66l-.7.7m-12.28 12.28l-.7.7M21 12h-1M4 12H3m15.66 8.66l-.7-.7m-12.28-12.28l-.7-.7"></path></svg>
        <svg class="moon-icon h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
      </button>
    </div>
  </header>



  <!-- Desktop Sidebar (hidden on mobile) -->
  <div class="fixed top-0 right-0 w-64 h-full bg-slate-100 dark:bg-slate-800 border-l border-gray-200 dark:border-slate-700 transform translate-x-full transition-transform duration-300 ease-in-out md:translate-x-0 z-40" id="sidebar">
    <div class="p-6 pt-20">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Tools</h2>
      <nav class="space-y-2">
        <button onclick="showDashboard()" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          Home Dashboard
        </button>
        <button onclick="launchAppFromCard('splitter')" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          EPUB Chapter Splitter
        </button>

        <button onclick="launchAppFromCard('zipEpub')" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          ZIP ↔ EPUB
        </button>
        <button onclick="launchAppFromCard('createBackupFromZip')" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          Create Backup from ZIP
        </button>
        <button onclick="launchAppFromCard('mergeBackup')" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          Merge Backups
        </button>
        <button onclick="launchAppFromCard('augmentBackupWithZip')" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          Augment Backup with ZIP
        </button>
        <button onclick="launchAppFromCard('findReplaceBackup')" class="w-full text-left px-4 py-3 rounded-lg text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700 transition-all duration-200">
          Find & Replace Backup
        </button>
      </nav>
    </div>
  </div>

  <!-- Main Content Container -->
  <main class="flex-1 pb-20 md:pb-0 md:mr-64">
    <!-- Dashboard Section -->
    <section id="dashboardApp" class="min-h-screen p-4 md:p-8 animate-fade-in">
      <div class="max-w-6xl mx-auto">
        <!-- Header with improved typography -->
        <div class="text-center mb-12 animate-bounce-in">
          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4 bg-gradient-to-r from-primary-400 to-primary-600 bg-clip-text text-transparent">
            Novel-Apps
          </h1>
          <p class="text-slate-600 dark:text-slate-300 text-lg max-w-2xl mx-auto leading-relaxed">
            Professional EPUB and novel backup management tools for writers and publishers
          </p>
        </div>

        <!-- Tool Cards Grid - Enhanced Mobile First -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
          <!-- EPUB Chapter Splitter -->
          <div class="tool-card group bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-slate-50/80 dark:hover:bg-slate-700/60 hover:border-primary-500/50 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl hover:shadow-primary-500/10 animate-slide-in"
               onclick="launchAppFromCard('splitter')"
               role="button"
               tabindex="0"
               aria-label="Launch EPUB Chapter Splitter">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 text-center group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">EPUB Chapter Splitter</h2>
            <p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed text-center mb-4">
              Divide EPUB files into individual or grouped chapter text files with precision control.
            </p>
            <div class="flex items-center justify-center text-xs text-primary-500 dark:text-primary-400 group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">
              <span>Chapter Selection</span>
            </div>
          </div>

          <!-- ZIP ↔ EPUB Converter -->
          <div class="tool-card group bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-slate-50/80 dark:hover:bg-slate-700/60 hover:border-primary-500/50 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl hover:shadow-primary-500/10 animate-slide-in"
               onclick="launchAppFromCard('zipEpub')"
               role="button"
               tabindex="0"
               aria-label="Launch ZIP ↔ EPUB Converter">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 text-center group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">ZIP ↔ EPUB</h2>
            <p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed text-center mb-4">
              Convert between ZIP files and EPUB format with bidirectional support and customization.
            </p>
            <div class="flex items-center justify-center text-xs text-primary-500 dark:text-primary-400 group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">
              <span>Bidirectional</span>
            </div>
          </div>

          <!-- Create Backup from ZIP -->
          <div class="tool-card group bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-slate-50/80 dark:hover:bg-slate-700/60 hover:border-primary-500/50 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl hover:shadow-primary-500/10 animate-slide-in"
               onclick="launchAppFromCard('createBackupFromZip')"
               role="button"
               tabindex="0"
               aria-label="Launch Create Backup from ZIP tool">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 text-center group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">Create Backup from ZIP</h2>
            <p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed text-center mb-4">
              Generate structured novel backup files directly from ZIP archives containing text chapters.
            </p>
            <div class="flex items-center justify-center text-xs text-primary-500 dark:text-primary-400 group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">
              <span>Auto-Generate</span>
            </div>
          </div>

          <!-- Merge Backup Files -->
          <div class="tool-card group bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-slate-50/80 dark:hover:bg-slate-700/60 hover:border-primary-500/50 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl hover:shadow-primary-500/10 animate-slide-in"
               onclick="launchAppFromCard('mergeBackup')"
               role="button"
               tabindex="0"
               aria-label="Launch Merge Backup Files tool">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 text-center group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">Merge Backup Files</h2>
            <p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed text-center mb-4">
              Combine multiple novel backup files into a single, organized backup with smart conflict resolution.
            </p>
            <div class="flex items-center justify-center text-xs text-primary-500 dark:text-primary-400 group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">
              <span>Smart Merge</span>
            </div>
          </div>

          <!-- Augment Backup with ZIP -->
          <div class="tool-card group bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-slate-50/80 dark:hover:bg-slate-700/60 hover:border-primary-500/50 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl hover:shadow-primary-500/10 animate-slide-in"
               onclick="launchAppFromCard('augmentBackupWithZip')"
               role="button"
               tabindex="0"
               aria-label="Launch Augment Backup with ZIP tool">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 text-center group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">Augment Backup with ZIP</h2>
            <p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed text-center mb-4">
              Expand existing novel backups by adding new chapters from ZIP files seamlessly.
            </p>
            <div class="flex items-center justify-center text-xs text-primary-500 dark:text-primary-400 group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">
              <span>Expand</span>
            </div>
          </div>

          <!-- Find & Replace in Backup -->
          <div class="tool-card group bg-white/60 dark:bg-slate-800/40 backdrop-blur-sm border border-slate-200 dark:border-slate-700/50 rounded-xl p-6 hover:bg-slate-50/80 dark:hover:bg-slate-700/60 hover:border-primary-500/50 transition-all duration-300 cursor-pointer hover:-translate-y-1 hover:scale-[1.02] hover:shadow-xl hover:shadow-primary-500/10 animate-slide-in md:col-span-2 lg:col-span-3"
               onclick="launchAppFromCard('findReplaceBackup')"
               role="button"
               tabindex="0"
               aria-label="Launch Find & Replace in Backup tool">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 text-center group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">Find & Replace in Backup</h2>
            <p class="text-slate-600 dark:text-slate-300 text-sm leading-relaxed text-center mb-4">
              Perform powerful find and replace operations within novel backup files with regex support and preview.
            </p>
            <div class="flex items-center justify-center text-xs text-primary-500 dark:text-primary-400 group-hover:text-primary-500 dark:group-hover:text-primary-300 transition-colors">
              <span>Advanced Search</span>
            </div>
          </div>
        </div>

        <!-- Footer with additional info -->
        <div class="mt-16 text-center">
          <p class="text-slate-500 dark:text-slate-400 text-sm">
            💡 <strong>Tip:</strong> All tools support drag-and-drop file uploads and provide real-time feedback
          </p>
        </div>
      </div>
    </section>

    <!-- Enhanced EPUB Splitter -->
    <div id="splitterApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">EPUB Chapter Splitter</h1>

      <!-- Upload Section -->
      <div class="max-w-md mx-auto">
        <label for="epubUpload" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="epubUploadLabel">Upload EPUB File</label>
        <input type="file" id="epubUpload" accept=".epub" class="hidden" aria-labelledby="epubUploadLabel">
        <div class="mt-2.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
            <span id="epubFileName" class="text-slate-500 dark:text-slate-300 max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
            <button type="button" id="clearEpubUpload" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear EPUB file" style="display:none;">&times;</button>
        </div>
      </div>

      <!-- Chapter Selection Area -->
      <div id="splitterChapterSelectionArea" class="mt-6 p-4 bg-slate-100 dark:bg-slate-700/30 rounded-lg border border-slate-200 dark:border-slate-600/50" style="display:none;">
        <div class="flex items-center justify-between mb-4">
          <h4 class="text-lg font-semibold text-slate-800 dark:text-slate-200">Select Chapters to Split</h4>
          <div class="text-sm text-primary-600 dark:text-primary-400" id="chapterCount">0 chapters found</div>
        </div>
        <div class="mb-4 flex justify-center gap-3">
          <button type="button" id="splitterSelectAllChapters" class="inline-flex items-center justify-center rounded-lg font-medium bg-teal-600 hover:bg-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 px-3 py-1 text-sm">Select All</button>
          <button type="button" id="splitterDeselectAllChapters" class="inline-flex items-center justify-center rounded-lg font-medium bg-teal-600 hover:bg-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 px-3 py-1 text-sm">Deselect All</button>
        </div>
        <ul id="splitterChapterList" class="max-w-xl mx-auto max-h-48 overflow-y-auto bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg p-3 list-none text-left" aria-label="List of EPUB chapters for selection">
          <!-- Chapters will be populated here by JS -->
        </ul>
      </div>

      <!-- Configuration Section -->
      <div class="max-w-md mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="modeSelect" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Output Mode:
            </label>
            <select id="modeSelect" class="bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
              <option value="single">Single Chapter per File</option>
              <option value="grouped">Grouped Chapters per File</option>
            </select>
          </div>
          <div>
            <label for="chapterPattern" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Chapter Prefix:
              <span class="tooltip-trigger relative group inline-block ml-1 cursor-help text-primary-600 font-bold border border-primary-600 rounded-full w-5 h-5 leading-4 text-center text-xs hover:bg-primary-600 hover:text-white" aria-label="More info about Chapter Prefix" role="button" tabindex="0">(?)
                <span class="tooltip-text-popup absolute bottom-full left-1/2 -ml-[110px] w-[220px] invisible opacity-0 group-hover:visible group-hover:opacity-100 group-[.active]:visible group-[.active]:opacity-100 bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 text-left rounded-md p-2 z-10 shadow-lg text-sm transition-opacity duration-300">
                  Pattern for naming output files, e.g., 'C' will result in C01.txt, C02.txt. Click to dismiss.
                  <div class="absolute top-full left-1/2 -ml-1 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-slate-100 dark:border-t-slate-800"></div>
                </span>
              </span>
            </label>
            <input type="text" id="chapterPattern" placeholder="e.g., Chapter " value="Chapter " class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
          </div>
          <div>
            <label for="startNumber" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Start Number:
            </label>
            <input type="number" id="startNumber" min="1" value="1" aria-describedby="statusMessage" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
          </div>
          <div>
            <label for="offsetNumber" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Skip First (Offset):
            </label>
            <input type="number" id="offsetNumber" min="0" value="0" aria-describedby="statusMessage" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
          </div>
        </div>

        <!-- Group Size (shown when grouped mode selected) -->
        <div class="mt-4 p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30" id="groupSizeGroup" style="display:none;">
          <label for="groupSize" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
            Chapters per File:
          </label>
          <input type="number" id="groupSize" min="1" value="4" aria-describedby="statusMessage" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">When using grouped mode, how many chapters to include in each output file</p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-8 flex justify-center gap-4">
        <button id="splitBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed" disabled>
          Split EPUB
        </button>
      </div>

      <!-- Progress and Status -->
      <div id="spinnerSplitter" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin my-4 mx-auto" role="status" aria-live="polite" aria-label="Loading" style="display:none;"></div>
      <div id="statusMessage" class="rounded-xl p-4 mt-5 text-center text-sm" style="display:none;" aria-live="polite"></div>

      <!-- Download Section -->
      <div class="download-section mt-6 p-4 bg-green-50 dark:bg-green-600/10 border border-green-200 dark:border-green-500/30 rounded-lg" style="display:none;">
        <div class="text-center">
          <div class="text-green-700 dark:text-green-400 text-lg mb-2">EPUB Split Complete!</div>
          <a id="downloadLink" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-orange-600 hover:bg-orange-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 gap-2">
            Download Chapters ZIP
          </a>
        </div>
      </div>
    </div>



    <!-- Enhanced Merge Backup Files -->
    <div id="mergeBackupApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">Merge Backup Files</h1>

      <!-- Upload Section -->
      <div class="max-w-md mx-auto mb-6">
        <label for="mergeBackupFiles" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="mergeBackupFilesLabel">Upload Backup Files</label>
        <input type="file" id="mergeBackupFiles" class="hidden" accept=".json,.txt,.nov" multiple aria-labelledby="mergeBackupFilesLabel">
        <div class="text-left max-h-32 overflow-y-auto p-3 rounded-lg mt-2 bg-slate-100 dark:bg-slate-700/50 border border-slate-300 dark:border-slate-600/50" id="mergeBackupFileNamesArea">
              <div class="text-xs text-slate-500 dark:text-slate-400 mb-2">Selected files:</div>
              <div id="mergeBackupFileNames" class="text-sm text-slate-700 dark:text-slate-300">No files selected.</div>
              <button type="button" id="clearMergeBackupFiles" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white mt-2" aria-label="Clear backup files" style="display:none;">&times;</button>
        </div>
        <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Upload multiple .json or .nov backup files to merge</p>
      </div>

      <!-- Configuration Sections -->
      <div class="space-y-6 max-w-md mx-auto">
        <!-- Project Information -->
        <div class="p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            Project Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="mergeProjectTitle" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Merged Project Title:
              </label>
              <input type="text" id="mergeProjectTitle" placeholder="Enter merged project title" aria-describedby="statusMergeBackup" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
          </div>
          <div class="mt-4">
            <label for="mergeDescription" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Merged Description:
            </label>
            <textarea id="mergeDescription" placeholder="Enter merged project description" rows="3" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full min-h-[80px]"></textarea>
          </div>
        </div>

        <!-- Chapter Configuration -->
        <div class="p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            Chapter Configuration
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="mergePrefix" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Prefix for Chapters (Optional):
              </label>
              <input type="text" id="mergePrefix" placeholder="e.g., Part I - " class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
          </div>
          <div class="mt-4">
            <label class="flex items-center gap-2 justify-start text-slate-800 dark:text-slate-200 select-none cursor-pointer" for="mergePreserveTitles">
                <input type="checkbox" id="mergePreserveTitles" class="w-4 h-4 align-middle rounded border-slate-400 dark:border-slate-500 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-100 dark:focus:ring-offset-slate-800 accent-primary-600" /> Preserve Original Chapter Titles
            </label>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">
              If checked, uses original titles. If "Prefix" is also filled, it's added before the original title.
            </p>
          </div>
        </div>

        <!-- Merge Information -->
        <div class="p-4 bg-blue-50 dark:bg-blue-600/10 rounded-lg border border-blue-200 dark:border-blue-500/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            Merge Information
          </h3>
          <ul class="text-xs text-slate-600 dark:text-slate-300 space-y-2">
            <li>• <strong>Status definitions:</strong> Merged from all files (duplicates removed, re-ranked)</li>
            <li>• <strong>Chapter titles:</strong> Either preserved or renamed with prefix + sequential numbers</li>
            <li>• <strong>Chapter order:</strong> All chapters re-ranked sequentially in the merged file</li>
            <li>• <strong>Word count:</strong> Automatically calculated from all merged content</li>
          </ul>
        </div>
      </div>

      <!-- Action Button -->
      <div class="mt-8 flex justify-center">
        <button id="mergeBackupBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed">
          Merge and Download
        </button>
      </div>

      <!-- Progress and Status -->
      <div id="spinnerMergeBackup" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin my-4 mx-auto" role="status" aria-live="polite" aria-label="Loading" style="display:none;"></div>
      <div id="statusMergeBackup" class="rounded-xl p-4 mt-5 text-center text-sm" style="display:none;" aria-live="polite"></div>

      <!-- Workflow Tips -->
      <div class="mt-6 p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30 max-w-md mx-auto">
        <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 mb-2 flex items-center gap-2">
          Workflow Tips
        </h4>
        <ul class="text-xs text-slate-600 dark:text-slate-300 space-y-1">
          <li>• Upload multiple backup files to combine into one</li>
          <li>• Choose whether to preserve original chapter titles or use a prefix</li>
          <li>• The tool will automatically handle duplicate status definitions</li>
          <li>• All chapters will be re-numbered sequentially in the final backup</li>
        </ul>
      </div>
    </div>

    <!-- Enhanced Augment Backup with ZIP -->
    <div id="augmentBackupWithZipApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">Augment Backup with ZIP</h1>

      <!-- Upload Section -->
      <div class="mb-6 max-w-md mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Base Backup Upload -->
          <div>
            <label for="augmentBaseBackupFile" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="augmentBaseBackupFileLabel">Base Backup File</label>
            <input type="file" id="augmentBaseBackupFile" class="hidden" accept=".json,.txt,.nov" aria-labelledby="augmentBaseBackupFileLabel">
            <div class="mt-2.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
                  <span id="augmentBaseBackupFileName" class="text-slate-500 dark:text-slate-300 max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
                  <button type="button" id="clearAugmentBaseBackupFile" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear base backup file" style="display:none;">&times;</button>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Upload your existing backup file</p>
          </div>

          <!-- ZIP File Upload -->
          <div>
            <label for="augmentZipFile" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="augmentZipFileLabel">ZIP with Chapters</label>
            <input type="file" id="augmentZipFile" class="hidden" accept=".zip" aria-labelledby="augmentZipFileLabel">
            <div class="mt-2.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
                  <span id="augmentZipFileName" class="text-slate-500 dark:text-slate-300 max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
                  <button type="button" id="clearAugmentZipFile" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear ZIP file" style="display:none;">&times;</button>
            </div>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Upload ZIP containing new chapter files</p>
          </div>
        </div>
      </div>

      <!-- Configuration Sections -->
      <div class="space-y-6 max-w-md mx-auto">
        <!-- Chapter Configuration -->
        <div class="p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            Chapter Configuration
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="augmentPrefix" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Prefix for New Chapters:
              </label>
              <input type="text" id="augmentPrefix" placeholder="e.g., New Section - " class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
            <div>
              <label for="augmentStartNumber" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Start Number for New Chapters:
              </label>
              <input type="number" id="augmentStartNumber" min="1" value="1" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
          </div>
          <div class="mt-4">
            <label class="flex items-center gap-2 justify-start text-slate-800 dark:text-slate-200 select-none cursor-pointer" for="augmentPreserveTxtTitles">
                <input type="checkbox" id="augmentPreserveTxtTitles" class="w-4 h-4 align-middle rounded border-slate-400 dark:border-slate-500 focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-slate-100 dark:focus:ring-offset-slate-800 accent-primary-600"/> Use .txt filenames as titles for new chapters
            </label>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">
              If checked, .txt filenames (without extension) are used as titles.
              If 'Prefix' is also provided: it's prepended UNLESS the .txt filename ALREADY starts with that prefix.
              If unchecked, 'Prefix + Sequential Number' or 'Chapter + Sequential Number' is used for new chapters.
            </p>
          </div>
        </div>

        <!-- Augmentation Information -->
        <div class="p-4 bg-green-50 dark:bg-green-600/10 rounded-lg border border-green-200 dark:border-green-500/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            Augmentation Information
          </h3>
          <ul class="text-xs text-slate-600 dark:text-slate-300 space-y-2">
            <li>• <strong>Preserves existing content:</strong> Your original backup remains unchanged</li>
            <li>• <strong>Adds new chapters:</strong> ZIP chapters are appended to the end</li>
            <li>• <strong>Updates metadata:</strong> Word count and timestamps are recalculated</li>
            <li>• <strong>Smart numbering:</strong> New chapters continue from the last chapter number</li>
          </ul>
        </div>
      </div>

      <!-- Action Button -->
      <div class="mt-8 flex justify-center">
        <button id="augmentBackupBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed" disabled>
          Augment and Download
        </button>
      </div>

      <!-- Progress and Status -->
      <div id="spinnerAugmentBackup" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin my-4 mx-auto" role="status" aria-live="polite" aria-label="Loading" style="display:none;"></div>
      <div id="statusAugmentBackup" class="rounded-xl p-4 mt-5 text-center text-sm" style="display:none;" aria-live="polite"></div>

      <!-- Workflow Tips -->
      <div class="mt-6 p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30 max-w-md mx-auto">
        <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 mb-2 flex items-center gap-2">
          Workflow Tips
        </h4>
        <ul class="text-xs text-slate-600 dark:text-slate-300 space-y-1">
          <li>• Upload your existing backup file first, then the ZIP with new chapters</li>
          <li>• Choose whether to use .txt filenames or auto-generated titles</li>
          <li>• The tool will preserve all your existing content and metadata</li>
          <li>• New chapters will be added at the end with sequential numbering</li>
        </ul>
      </div>
    </div>


    <!-- Enhanced Find & Replace in Backup File -->
    <div id="findReplaceBackupApp" class="tool-section p-0 sm:pb-[130px] box-border flex flex-col h-[calc(100vh-56px-env(safe-area-inset-top))] md:h-[calc(100vh-72px-env(safe-area-inset-top))] max-w-full relative overflow-hidden bg-slate-100 dark:bg-slate-800" style="display:none;">
      <!-- Initial Upload View -->
      <div id="frUploadArea" class="absolute inset-0 bg-white/80 dark:bg-slate-900/50 z-10 flex flex-col items-center justify-center p-4 transition-opacity duration-300 ease-in-out">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">Find & Replace in Backup</h1>
        <div class="max-w-md mx-auto">
          <label for="frBackupFile" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="frBackupFileLabel">Upload Backup File</label>
          <input type="file" id="frBackupFile" accept=".json,.txt,.nov" class="hidden" aria-labelledby="frBackupFileLabel">
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Upload a .json, .txt, or .nov backup file to begin.</p>
        </div>
      </div>
    
      <!-- Context Snippet Preview Area -->
      <div id="frSnippetPreview" class="flex-grow flex items-center justify-center p-4 overflow-y-auto font-serif text-lg leading-loose text-slate-800 dark:text-slate-200">
        <p class="max-w-prose text-left text-slate-500 dark:text-slate-400 italic">Upload a backup file to begin.</p>
      </div>
    
      <!-- Download Button Container -->
      <div id="frDownloadContainer" class="absolute top-4 right-4 z-10 transition-transform duration-300" style="display: none;">
        <button id="downloadCurrentFrBackupBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed" disabled>Download Backup</button>
      </div>
    
      <!-- Floating HUD -->
      <div id="frHud" class="fixed bottom-0 left-0 right-0 z-20 p-2 pb-[calc(0.5rem+env(safe-area-inset-bottom))] transform translate-y-full transition-transform duration-300 ease-out" style="display: none;">
        <div class="relative max-w-3xl mx-auto bg-slate-50/80 dark:bg-slate-800/80 backdrop-blur-md border border-slate-300 dark:border-slate-700 rounded-xl shadow-2xl p-3 transition-height">
          <!-- Options Popover -->
          <div id="frOptionsPopover" class="absolute bottom-[calc(100%+8px)] right-0 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-4 w-72 shadow-lg z-20" style="display: none;">
            <div class="mb-3">
                <label for="frScopeSelect" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Search In</label>
                <select id="frScopeSelect" class="w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg px-3 py-1.5 text-sm text-gray-900 dark:text-white focus:border-primary-500 focus:ring-1 focus:ring-primary-500 transition-all"></select>
            </div>
            <div class="flex justify-between bg-slate-100 dark:bg-slate-700 rounded-md">
                <label class="flex-1 flex justify-center p-1.5 transition-colors duration-200 rounded-md has-[:checked]:bg-primary-500/20" for="useRegexBackup" title="Use Regular Expression">
                    <input type="checkbox" id="useRegexBackup" class="hidden">
                    <span class="text-sm font-mono text-slate-600 dark:text-slate-300 has-[:checked]:text-primary-600">Regex</span>
                </label>
                <label class="flex-1 flex justify-center p-1.5 transition-colors duration-200 rounded-md has-[:checked]:bg-primary-500/20" for="frCaseSensitiveCheckbox" title="Case Sensitive">
                    <input type="checkbox" id="frCaseSensitiveCheckbox" class="hidden">
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300 has-[:checked]:text-primary-600">Aa</span>
                </label>
                <label class="flex-1 flex justify-center p-1.5 transition-colors duration-200 rounded-md has-[:checked]:bg-primary-500/20" for="frWholeWordCheckbox" title="Match Whole Word">
                    <input type="checkbox" id="frWholeWordCheckbox" class="hidden">
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300 has-[:checked]:text-primary-600">" "</span>
                </label>
            </div>
          </div>
    
          <!-- Main HUD controls -->
          <div class="flex items-start gap-2">
            <div class="flex-shrink-0">
                <button id="frReplaceToggleBtn" class="bg-transparent border border-slate-300 dark:border-slate-600 text-slate-800 dark:text-slate-200 w-9 h-9 rounded-md inline-flex items-center justify-center text-xl transition-all hover:bg-primary-600 hover:text-white hover:border-primary-600 disabled:opacity-50 disabled:cursor-not-allowed" aria-expanded="false" title="Toggle Replace">
                    <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <div class="flex-grow">
                <div class="relative flex items-center">
                    <input type="text" id="findPattern" placeholder="Find" class="w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md px-2 py-1.5 pr-20 text-sm text-slate-800 dark:text-slate-200 focus:border-primary-500 focus:ring-1 focus:ring-primary-500">
                    <div id="frMatchCountDisplay" class="absolute right-2.5 top-1/2 -translate-y-1/2 text-xs text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-1 pointer-events-none">No results</div>
                </div>
                <div id="frReplaceRow" class="relative flex items-center mt-1 hidden">
                    <input type="text" id="replaceText" placeholder="Replace" class="w-full bg-slate-100 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md px-2 py-1.5 text-sm text-slate-800 dark:text-slate-200 focus:border-primary-500 focus:ring-1 focus:ring-primary-500">
                    <div class="absolute right-0 top-1/2 -translate-y-1/2 flex items-center">
                        <button id="replaceNextBtn" class="bg-transparent border-none text-slate-500 hover:text-primary-600 dark:text-slate-400 dark:hover:text-primary-400 p-1.5" title="Replace">
                            <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                        </button>
                        <button id="replaceAllBtn" class="bg-transparent border-none text-slate-500 hover:text-primary-600 dark:text-slate-400 dark:hover:text-primary-400 p-1.5" title="Replace All">
                           <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V4a2 2 0 00-2-2H6zm3.47 3.97a.75.75 0 011.06 0l2.5 2.5a.75.75 0 010 1.06l-2.5 2.5a.75.75 0 11-1.06-1.06L11.94 9 9.47 6.53a.75.75 0 010-1.06z" clip-rule="evenodd"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex-shrink-0 flex gap-2">
                <button id="findPreviousBtn" class="bg-transparent border border-slate-300 dark:border-slate-600 text-slate-800 dark:text-slate-200 w-9 h-9 rounded-md inline-flex items-center justify-center text-xl transition-all hover:bg-primary-600 hover:text-white hover:border-primary-600 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Find Previous">‹</button>
                <button id="findNextBtn" class="bg-transparent border border-slate-300 dark:border-slate-600 text-slate-800 dark:text-slate-200 w-9 h-9 rounded-md inline-flex items-center justify-center text-xl transition-all hover:bg-primary-600 hover:text-white hover:border-primary-600 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Find Next">›</button>
                <button id="frOptionsToggleBtn" class="bg-transparent border border-slate-300 dark:border-slate-600 text-slate-800 dark:text-slate-200 w-9 h-9 rounded-md inline-flex items-center justify-center text-xl transition-all hover:bg-primary-600 hover:text-white hover:border-primary-600 disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Search Options">
                    <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                </button>
                <button id="frDoneBtn" class="bg-transparent border border-slate-300 dark:border-slate-600 text-slate-800 dark:text-slate-200 w-9 h-9 rounded-md inline-flex items-center justify-center text-xl transition-all hover:bg-red-600 hover:text-white hover:border-red-600" aria-label="Close Find/Replace">&times;</button>
            </div>
          </div>
        </div>
      </div>
    
      <!-- Review All Modal -->
      <div id="frReviewModal" class="absolute inset-0 bg-slate-100/70 dark:bg-black/70 backdrop-blur-sm z-40 flex items-center justify-center p-4" style="display: none;">
        <div class="bg-white dark:bg-slate-800 rounded-xl border border-slate-300 dark:border-slate-700 w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden">
          <div class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center flex-shrink-0">
            <h2 id="frReviewHeaderTitle" class="text-xl font-semibold text-slate-900 dark:text-white">Review Changes</h2>
            <button id="frCloseReviewModalBtn" class="text-2xl bg-none border-none text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-white cursor-pointer" aria-label="Close review modal">&times;</button>
          </div>
          <div class="p-3 bg-slate-100 dark:bg-slate-900/50 flex-shrink-0">
            <label class="flex items-center gap-2 justify-start text-slate-800 dark:text-slate-200 select-none cursor-pointer">
              <input type="checkbox" id="frReviewSelectAll" class="w-4 h-4 align-middle rounded border-slate-400 dark:border-slate-500 focus:ring-2 focus:ring-primary-500 accent-primary-600" checked>
              <span id="frReviewSummaryText">X replacements proposed</span>
            </label>
          </div>
          <ul id="frReviewList" class="list-none p-0 m-0 overflow-y-auto flex-grow">
            <!-- Review items injected by JS -->
          </ul>
          <div class="p-4 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-4 flex-shrink-0">
            <button id="frCancelReviewBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-slate-200 hover:bg-slate-300 text-slate-800 dark:bg-slate-600 dark:hover:bg-slate-500 dark:text-white shadow-lg hover:shadow-xl transition-all">Cancel</button>
            <button id="frConfirmReplaceAllBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all">Confirm Replacements</button>
          </div>
        </div>
      </div>
    
      <!-- Global Spinner -->
      <div id="spinnerFindReplaceBackup" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50" style="display: none;"></div>
    </div>


    <!-- Enhanced Create Backup from ZIP -->
    <div id="createBackupFromZipApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">Create Backup from ZIP</h1>

      <!-- Upload Section -->
      <div class="max-w-md mx-auto mb-6">
        <label for="zipBackupFile" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="zipBackupFileLabel">📦 Upload ZIP File</label>
        <input type="file" id="zipBackupFile" class="hidden" accept=".zip" aria-labelledby="zipBackupFileLabel" aria-describedby="statusMessageCreateBackupFromZip">
        <div class="mt-2.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
              <span id="zipBackupFileName" class="text-slate-500 dark:text-slate-300 max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
              <button type="button" id="clearZipBackupFile" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear ZIP file" style="display:none;">&times;</button>
        </div>
        <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Upload a ZIP file containing .txt chapter files</p>
      </div>

      <!-- Configuration Sections -->
      <div class="space-y-6 max-w-md mx-auto">
        <!-- Project Information -->
        <div class="p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            <span>📝</span>Project Information
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="zipProjectTitle" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                <span>📚</span>Project Title:
              </label>
              <input type="text" id="zipProjectTitle" placeholder="Enter project title" aria-describedby="statusMessageCreateBackupFromZip" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
            <div>
              <label for="zipUniqueCode" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                <span>🔢</span>Unique Code (Optional):
              </label>
              <input type="text" id="zipUniqueCode" placeholder="Auto-generated if blank" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
          </div>
          <div class="mt-4">
            <label for="zipDescription" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              <span>📄</span>Description:
            </label>
            <textarea id="zipDescription" placeholder="Enter project description" rows="3" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full min-h-[80px]"></textarea>
          </div>
        </div>

        <!-- Chapter Configuration -->
        <div class="p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30">
          <h3 class="text-lg font-semibold text-slate-800 dark:text-slate-200 mb-4 flex items-center gap-2">
            <span>⚙️</span>Chapter Configuration
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="zipChapterPattern" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                <span>🏷️</span>Chapter Pattern:
                <span class="tooltip-trigger relative group inline-block ml-1 cursor-help text-primary-600 font-bold border border-primary-600 rounded-full w-5 h-5 leading-4 text-center text-xs hover:bg-primary-600 hover:text-white" aria-label="More info about Chapter Pattern" role="button" tabindex="0">(?)
                  <span class="tooltip-text-popup absolute bottom-full left-1/2 -ml-[110px] w-[220px] invisible opacity-0 group-hover:visible group-hover:opacity-100 group-[.active]:visible group-[.active]:opacity-100 bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 text-left rounded-md p-2 z-10 shadow-lg text-sm transition-opacity duration-300">
                    If provided, chapters will be named 'Pattern + Number'. E.g., 'Chapter 1', 'Chapter 2'. If blank, original .txt filenames are used. Click to dismiss.
                    <div class="absolute top-full left-1/2 -ml-1 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-slate-100 dark:border-t-slate-800"></div>
                  </span>
                </span>
              </label>
              <input type="text" id="zipChapterPattern" placeholder="e.g., Chapter " value="Chapter " class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
            <div>
              <label for="zipStartNumber" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                <span>🔢</span>Start Number:
              </label>
              <input type="number" id="zipStartNumber" min="1" value="1" aria-describedby="statusMessageCreateBackupFromZip" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            </div>
          </div>
          <div class="mt-4">
            <label for="zipExtraChapters" class="flex items-center gap-2 block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              <span>➕</span>Extra Empty Chapters:
            </label>
            <input type="number" id="zipExtraChapters" min="0" value="0" aria-describedby="statusMessageCreateBackupFromZip" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">Add this many empty chapters to the end of your backup</p>
          </div>
        </div>
      </div>

      <!-- Action Button -->
      <div class="mt-8 flex justify-center">
        <button id="createFromZipBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed" disabled>
          <span class="mr-2">⚡</span>Generate Backup and Download
        </button>
      </div>

      <!-- Progress and Status -->
      <div id="spinnerCreateBackupFromZip" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin my-4 mx-auto" role="status" aria-live="polite" aria-label="Loading" style="display:none;"></div>
      <div id="statusMessageCreateBackupFromZip" class="rounded-xl p-4 mt-5 text-center text-sm" style="display:none;" aria-live="polite"></div>

      <!-- Workflow Tips -->
      <div class="mt-6 p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30 max-w-md mx-auto">
        <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 mb-2 flex items-center gap-2">
          <span>💡</span>Workflow Tips
        </h4>
        <ul class="text-xs text-slate-600 dark:text-slate-300 space-y-1">
          <li>• Upload a ZIP file containing your chapter .txt files</li>
          <li>• Configure your project title and chapter naming pattern</li>
          <li>• Add extra empty chapters if you need placeholders for future content</li>
          <li>• The tool will automatically generate a structured backup file</li>
        </ul>
      </div>
    </div>


    <!-- ZIP to EPUB Converter -->
    <div id="zipToEpubApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">ZIP to EPUB Converter</h1>
      <div class="max-w-md mx-auto">
        <label for="zipUploadForEpub" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="zipUploadForEpubLabel">Upload ZIP File (.zip with .txt chapters)</label>
        <input type="file" id="zipUploadForEpub" accept=".zip" class="hidden" aria-labelledby="zipUploadForEpubLabel">
        <div class="mt-2.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
            <span id="zipFileNameForEpub" class="text-slate-500 dark:text-slate-300 max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
            <button type="button" id="clearZipUploadForEpub" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear ZIP file" style="display:none;">&times;</button>
        </div>
      </div>

      <div id="zipToEpubChapterArea" class="max-w-md mx-auto" style="display:none;">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Chapter Order and Titles:</label>
          <p class="text-xs text-slate-500 dark:text-slate-400 text-center -mt-1 mb-2">
              Drag to reorder. Click a title to edit it.
          </p>
          <ul id="zipToEpubChapterList" class="max-w-xl mx-auto list-none p-0 my-4 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-100 dark:bg-slate-800 max-h-64 overflow-y-auto" aria-label="List of chapters to include in the EPUB">
              <!-- Dynamically populated by JS -->
          </ul>
      </div>

      <div class="max-w-md mx-auto space-y-4">
        <div>
          <label for="epubTitle" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">EPUB Title:</label>
          <input type="text" id="epubTitle" placeholder="Enter EPUB title" value="My Novel" aria-describedby="statusMessageZipToEpub" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
        </div>
        <div>
          <label for="epubAuthor" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Author:</label>
          <input type="text" id="epubAuthor" placeholder="Enter author name" value="Unknown Author" aria-describedby="statusMessageZipToEpub" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
        </div>
        
        <div>
            <label for="epubCoverImage" id="epubCoverImageLabel" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Cover Image (Optional, JPG/PNG):</label>
            <input type="file" id="epubCoverImage" accept="image/jpeg,image/png" aria-labelledby="epubCoverImageLabel" class="mt-1 w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 dark:file:bg-primary-700/20 file:text-primary-700 dark:file:text-primary-300 hover:file:bg-primary-100 dark:hover:file:bg-primary-700/40">
            <div class="mt-1.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
                <span id="epubCoverFileName" class="text-slate-500 dark:text-slate-300 text-xs max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
                <button type="button" id="clearEpubCoverImage" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear cover image" style="display:none;">&times;</button>
            </div>
        </div>
        
        <details class="max-w-xl mx-auto mt-4 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-100/50 dark:bg-slate-800/20 overflow-hidden">
            <summary class="px-4 py-3 cursor-pointer outline-none font-medium text-slate-800 dark:text-slate-200 list-inside transition-colors hover:bg-slate-200/50 dark:hover:bg-slate-700/50">Advanced Options</summary>
            <div class="p-4 border-t border-slate-300 dark:border-slate-600">
                <div>
                  <label for="epubLanguage" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Language Code:</label>
                  <input type="text" id="epubLanguage" placeholder="e.g., en" value="en" aria-describedby="statusMessageZipToEpub" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 w-full">
                </div>
                <div class="mt-4">
                    <label class="flex items-center gap-2 justify-start text-slate-800 dark:text-slate-200 select-none cursor-pointer" for="processMarkdown">
                        <input type="checkbox" id="processMarkdown" class="w-4 h-4 align-middle rounded border-slate-400 dark:border-slate-500 focus:ring-2 focus:ring-primary-500 accent-primary-600"/> Process chapter text as Markdown
                    </label>
                     <p class="text-xs text-slate-500 dark:text-slate-400 text-center mt-1">
                        Supports headings (#), bold (**text**), and italic (*text*).
                    </p>
                </div>
            </div>
        </details>
      </div>
      <div class="text-center">
        <button id="createEpubBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed" disabled>Create EPUB</button>
      </div>
      <div id="spinnerZipToEpub" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin my-4 mx-auto" role="status" aria-live="polite" aria-label="Loading" style="display:none;"></div>
      <div id="statusMessageZipToEpub" class="rounded-xl p-4 mt-5 text-center text-sm" style="display:none;" aria-live="polite"></div>
      <div class="text-center" id="downloadSectionZipToEpub" style="display:none;">
        <a id="downloadLinkEpub" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-orange-600 hover:bg-orange-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100">Download EPUB</a>
      </div>
    </div>

    <!-- EPUB to ZIP (TXT) Converter -->
    <div id="epubToZipApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">EPUB to ZIP (TXT)</h1>
      <div class="max-w-md mx-auto">
        <label for="epubUploadForTxt" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-violet-600 hover:bg-violet-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 w-full cursor-pointer" id="epubUploadForTxtLabel">Upload EPUB File</label>
        <input type="file" id="epubUploadForTxt" accept=".epub" class="hidden" aria-labelledby="epubUploadForTxtLabel">
        <div class="mt-2.5 flex items-center justify-center bg-slate-100 dark:bg-slate-700/50 p-2 rounded-md min-h-[40px]">
            <span id="epubFileNameForTxt" class="text-slate-500 dark:text-slate-300 max-w-[calc(100%-30px)] overflow-hidden text-ellipsis whitespace-nowrap inline-block"></span>
            <button type="button" id="clearEpubUploadForTxt" class="bg-transparent border-none text-slate-500 text-2xl font-bold cursor-pointer ml-2 p-1 leading-none transition-colors hover:text-slate-800 dark:hover:text-white" aria-label="Clear EPUB file" style="display:none;">&times;</button>
        </div>
      </div>

      <div id="epubToZipChapterSelectionArea" style="display:none;" class="mt-4">
        <h4 class="text-lg font-semibold text-slate-800 dark:text-slate-200 text-center">Select Chapters to Extract:</h4>
        <div class="my-4 flex justify-center gap-3">
          <button type="button" id="epubToZipSelectAllChapters" class="inline-flex items-center justify-center rounded-lg font-medium bg-teal-600 hover:bg-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 px-3 py-1 text-sm">Select All</button>
          <button type="button" id="epubToZipDeselectAllChapters" class="inline-flex items-center justify-center rounded-lg font-medium bg-teal-600 hover:bg-teal-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 px-3 py-1 text-sm">Deselect All</button>
        </div>
        <ul id="epubToZipChapterList" class="max-w-xl mx-auto max-h-48 overflow-y-auto bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg p-3 list-none text-left" aria-label="List of EPUB chapters for text extraction">
          <!-- Chapters will be populated here by JS -->
        </ul>
      </div>

      <div class="max-w-md mx-auto space-y-4">
        <div>
          <label class="flex items-center gap-2 justify-center text-slate-800 dark:text-slate-200 select-none cursor-pointer" for="epubToZipEnableRemoveLines">
            <input type="checkbox" id="epubToZipEnableRemoveLines" class="w-4 h-4 align-middle rounded border-slate-400 dark:border-slate-500 focus:ring-2 focus:ring-primary-500 accent-primary-600"/>
            Remove initial lines from chapters
          </label>
        </div>
        <div id="epubToZipRemoveLinesOptionsGroup" style="display:none;" class="text-center">
          <label for="epubToZipLinesToRemove" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Number of lines to remove:</label>
          <input type="number" id="epubToZipLinesToRemove" min="0" value="1" aria-describedby="statusMessageEpubToZip" class="bg-slate-100 dark:bg-slate-700 border-2 border-transparent rounded-lg px-3 py-2 text-gray-900 dark:text-white focus:border-primary-500 focus:ring-2 focus:ring-primary-500/50 transition-all duration-200 max-w-[100px] mx-auto">
        </div>
      </div>
      <div class="text-center">
        <button id="extractChaptersBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-primary-600 hover:bg-primary-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100 disabled:opacity-60 disabled:cursor-not-allowed" disabled>Extract Chapters to ZIP</button>
      </div>
      <div id="spinnerEpubToZip" class="w-10 h-10 border-4 border-slate-200 dark:border-slate-700 rounded-full border-t-primary-600 animate-spin my-4 mx-auto" role="status" aria-live="polite" aria-label="Loading" style="display:none;"></div>
      <div id="statusMessageEpubToZip" class="rounded-xl p-4 mt-5 text-center text-sm" style="display:none;" aria-live="polite"></div>
      <div class="text-center" id="downloadSectionEpubToZip" style="display:none;">
        <a id="downloadLinkZipFromEpub" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium bg-orange-600 hover:bg-orange-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-offset-slate-100">Download Chapter TXTs</a>
      </div>
    </div>

    <!-- Enhanced Combined ZIP ↔ EPUB Tool -->
    <div id="zipEpubApp" class="max-w-3xl md:max-w-4xl mx-auto p-4 md:p-6 bg-white/70 dark:bg-slate-800/50 backdrop-blur-sm border border-slate-200 dark:border-slate-700 rounded-xl shadow-sm space-y-5 animate-fade-in tool-section" style="display:none;">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-5 text-center">ZIP ↔ EPUB Converter</h1>

      <!-- Enhanced Mode Switch with Icons -->
      <div class="max-w-md mx-auto mb-6">
        <label class="text-center block mb-4 text-slate-800 dark:text-slate-200">Conversion Direction:</label>
        <div class="flex justify-center gap-3 mt-2">
          <button id="zipToEpubMode" class="flex items-center gap-2 px-6 py-3 rounded-lg font-medium bg-primary-600 text-white shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-500 hover:bg-primary-700 hover:scale-105">
            <span class="text-lg">📦</span>
            <span>ZIP → EPUB</span>
          </button>
          <button id="epubToZipMode" class="flex items-center gap-2 px-6 py-3 rounded-lg font-medium bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 shadow-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-slate-500 hover:bg-slate-300 dark:hover:bg-slate-600 hover:scale-105">
            <span class="text-lg">📖</span>
            <span>EPUB → ZIP</span>
          </button>
        </div>
        <p class="text-xs text-slate-500 dark:text-slate-400 text-center mt-3">Choose your conversion direction</p>
      </div>

      <!-- Host container for the original tool sections -->
      <div id="zipEpubHost"></div>

      <!-- Workflow Tips -->
      <div class="mt-8 p-4 bg-slate-100/50 dark:bg-slate-700/20 rounded-lg border border-slate-200 dark:border-slate-600/30 max-w-md mx-auto">
        <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 mb-2 flex items-center gap-2">
          <span>💡</span>Workflow Tips
        </h4>
        <ul class="text-xs text-slate-600 dark:text-slate-300 space-y-1">
          <li>• <strong>ZIP → EPUB:</strong> Convert text chapters to professional EPUB format</li>
          <li>• <strong>EPUB → ZIP:</strong> Extract chapters from EPUB files as text</li>
          <li>• Both directions support drag-and-drop file uploads</li>
          <li>• Advanced options available in the expandable sections</li>
        </ul>
      </div>
    </div>



  </div>

  <div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg text-white font-medium z-50 transition-opacity duration-300 opacity-0" role="alert" aria-live="assertive"></div>

  <!-- JSZip fallback for offline use -->
  <script src="jszip.min.js"></script>

  <script type="module" src="js/index.js"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>